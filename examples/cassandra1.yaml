apiVersion: "core.sky.uk/v1alpha1"
kind: "Cassandra"
metadata:
  name: "cluster-1"
  namespace: "example.com"
spec:
  datacenter: "region-1"
  racks:
  - name: "region-1-zone-a"
    zone: "zone-a"
    replicas: 3
  nodePodConfiguration:
    bootstrapperImage: "skyuk/cassandra-bootstrapper:latest"
    image: "cassandra:3.11"
    persistence:
      storageClass: "local-ssd"
      size: "100Gi"
    livenessProbe:
      failureThreshold: 1
      initialDelaySeconds: 10
      periodSeconds: 10
      successThreshold: 3
      timeoutSeconds: 30
    readinessProbe:
      failureThreshold: 1
      initialDelaySeconds: 60
      periodSeconds: 10
      successThreshold: 3
      timeoutSeconds: 30
    resources:
      requests:
        cpu: "500m"
        memory: "1Gi"
      limits:
        cpu: "1"
        memory: "2Gi"
---
apiVersion: "core.sky.uk/v1alpha1"
kind: "CassandraSnapshotSchedule"
metadata:
  name: "cluster-1-daily"
  namespace: "example.com"
spec:
  schedule: "0 4 * * *"
  cleanupSchedule: "0 4 * * *"
  template:
    clusterName: "cluster-1"
    image: "skyuk/cassandra-snapshot:latest"
    keyspaces:
    - "mykeyspace"
    - "system_auth"
    timeoutSeconds: 30
    retentionPolicy:
      retentionPeriodDays: 60
---
apiVersion: "core.sky.uk/v1alpha1"
kind: "CassandraSnapshot"
metadata:
  name: "cluster-1-ondemand-snapshot-1"
  namespace: "example.com"
spec:
  clusterName: "cluster-1"
  image: "skyuk/cassandra-snapshot:latest"
  keyspaces:
  - "mykeyspace"
  - "system_auth"
  timeoutSeconds: 30
  retentionPolicy:
    retentionPeriodDays: 10
